/* global requirejs, require */
/*jslint node: true */

export default function () {
  //opts = opts || {require: require, requirejs: requirejs}
  //console.log(opts.require);
  //var prefix = config.  modulePrefix;
  var factoryFileRegExp = new RegExp('/tests/factories');
  //var factoryFileRegExp = new RegExp('^' + prefix + '/tests/factories');

  //Object.keys(opts.requirejs._eak_seen).filter(function (key) {
  Object.keys(requirejs._eak_seen).filter(function (key) {
    return factoryFileRegExp.test(key);
  }).forEach(function (moduleName) {
    //console.log(moduleName);
    if (moduleName.match('.jshint')) { // ignore autogenerated .jshint files
      return;
    }
    if (moduleName.match('.jscs')) { // ignore autogenerated .jscs files
      return;
    }
    require(moduleName, null, null, true);
    //opts.require(moduleName, null, null, true);
  });
}