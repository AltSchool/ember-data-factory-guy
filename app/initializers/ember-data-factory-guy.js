import Ember from 'ember';
import FactoryGuy from 'ember-data-factory-guy/factory-guy';
import FactoryGuyTestHelper from 'ember-data-factory-guy/factory-guy-test-helper';
import config from '../config/environment';

export default {
  name: 'ember-data-factory-guy',
  after: 'ember-data',

  initialize: function(application) {
    var container = application.__container__;
    FactoryGuy.setStore(container.lookup('service:store'));
    FactoryGuyTestHelper.set('container', container);
    FactoryGuy.resetDefinitions();

    var prefix = config.modulePrefix;
    var factoryFileRegExp = new RegExp('^' + prefix + '/tests/factories');

    Object.keys(requirejs._eak_seen).filter(function(key) {
      return factoryFileRegExp.test(key);
    }).forEach(function(moduleName) {
      if (moduleName.match('.jshint')) { // ignore autogenerated .jshint files
        return;
      }
      if (moduleName.match('.jscs')) { // ignore autogenerated .jscs files
        return;
      }
      require(moduleName, null, null, true);
    });
  }
};
