import FactoryGuy from 'ember-data-factory-guy/factory-guy';
import ENV from '../config/environment';

export default {
  name: 'ember-data-factory-guy',
  after: 'store',

  initialize: function(container, application) {
    FactoryGuy.setStore(container.lookup('store:main'))

    //console.log('Hi Mom', container.lookup('store:main')+'', FactoryGuy.getStore()+'')
    //console.log('Hi Rob A', container.lookup('serializer:-default'))
    //console.log('Hi Rob B', container.lookup('adapter:-default'))
    //var normalizedPath = require("path")
    //console.log('Hi Rob C', requirejs._eak_seen)

    var prefix = ENV.modulePrefix
    var factoryFileRegExp = new RegExp('^' + prefix + '/tests/factories');

    Ember.keys(requirejs._eak_seen).filter(function(key) {
      return factoryFileRegExp.test(key);
    }).forEach(function(moduleName) {
      //console.log(moduleName)
      if (moduleName.match('.jshint')) { // ignore autogenerated .jshint files
        return;
      }
      require(moduleName, null, null, true);
    });

  }
};
